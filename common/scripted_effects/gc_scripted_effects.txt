change_government_to_gc_ethiopia_Government = {
	if = {
		limit = {
			NOT = { government = gc_ethiopian_government }
		}
		if = {
			limit = {
				government = republic
			}
			change_government = gc_ethiopian_government
			lose_reforms = 4
		}
		else = {
			change_government = gc_ethiopian_government
			lose_reforms = 2
		}
	}
}
remove_steppe_devcost_ukr = {
	if = {
		limit = {
			any_owned_province = { has_province_modifier = estate_nomadic_tribes_steppe_devcost }
		}
		every_owned_province = {
			limit = {
				has_province_modifier = estate_nomadic_tribes_steppe_devcost
			}
			remove_province_modifier = estate_nomadic_tribes_steppe_devcost
		}
	}
}

develop_adm = {
	random = {
		chance = 25
		add_base_tax = 1
	}
}	

subject_warscore = {
	if = { 
		limit = {
			is_subject = yes
			NOT = { is_colonial_nation = yes }
			ai = yes
			any_owned_province = {
				NOT = { has_province_modifier = subject_warscore }
			}		
		}
		every_owned_province = {
			limit = {
				NOT = { has_province_modifier = subject_warscore }
			}
			add_province_modifier = {
				name = subject_warscore
				duration = -1
				hidden = yes
			}
		}
	}
}

gecko_ipa_effect = {
	if = {
		limit = {
			NOT = { num_of_loans = 1 }
		}
		remove_country_modifier = gecko_ipa
		remove_country_modifier = gecko_debt_tackled
		remove_country_modifier = gecko_debt_tackled_2
		remove_country_modifier = gecko_tackle_debt_timer
	}
}

#gecko_occupation_effect = {
#		if = {
#			limit = {
#				ai = no
#				any_owned_province = {
#					has_province_modifier = gecko_occupation 
#					is_core = owner
#					controlled_by = owner
#				}	
#			}
#			remove_province_modifier = gecko_occupation
#		}
#		if = {
#			limit = {
#				ai = no
#				any_owned_province = {
#					has_province_flag = gecko_occupation
#					is_core = owner
#					controlled_by = owner
#				}
#			}
#			clr_province_flag = gecko_occupation
#		}
#		if = {
#			limit = {
#				ai = no
#				any_owned_province = {
#					has_province_flag = gecko_occupation_core
#					is_core = owner
#					controlled_by = owner
#				}
#			}
#			clr_province_flag = gecko_occupation_core
#		}
#}

gecko_mercs = {
	if = {
		limit = {
			ROOT = {
				ai = no
			}	
			has_country_modifier = Minor
		}
		hidden_effect = {
			export_to_variable = {
					which = geckomercFL
					value = land_forcelimit
					who = ROOT
			}
			divide_variable = {
					which = geckomercFL
					value = 100
			}
			multiply_variable = {
					which = geckomercFL
					value = 33
			}
			change_variable = {
					which = geckomercFL
					value = 30
			}
			set_variable = {            
					which = availablegeckomercs
					value = 1
			}		
			export_to_variable = {
						which = geckomercvalue
						value = trigger_value:num_of_mercenaries
						who = ROOT
			}
		}	
	}
	else_if = {
		limit = {
			ROOT = {
				ai = no
			}	
		}
		hidden_effect = {
			export_to_variable = {
					which = geckomercFL
					value = land_forcelimit
					who = ROOT
			}
			divide_variable = {
					which = geckomercFL
					value = 100
			}
			multiply_variable = {
					which = geckomercFL
					value = 33
			}
			change_variable = {
					which = geckomercFL
					value = 20
			}
			set_variable = {            
					which = availablegeckomercs
					value = 1
			}
			export_to_variable = {
						which = geckomercvalue
						value = trigger_value:num_of_mercenaries
						who = ROOT
			}
		}
	}
}

gecko_merc_count = {
	if = {
		limit = {
			ROOT = {
				ai = no
			}	
		}
		hidden_effect = {
			export_to_variable = {
						which = geckomercvalue
						value = trigger_value:num_of_mercenaries
						who = ROOT
			}
		}	
	}	
}	

regional_conquests = {
	if = {
		limit = {
			ROOT = {
				ai = no
			}
			any_country = {
				owns_all_provinces = {
					region = $region$ 
					}
			}	
		}
		hidden_effect = {
			$region$ = {
				add_province_modifier = {
					name = "regional_conquest"
					duration = -1
				}
			}	
		}	
	}	
}


add_or_upgrade_university_building = {
	custom_tooltip = add_or_upgrade_university_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = university
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
		else = {
			add_building = university
		}
	}
}

## create or add a CoT
### create_or_add_center_of_trade_level = { level = <number> }
create_or_add_center_of_trade_level = {
	if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				check_variable = { which = var value = 1 }
			}
		}
		if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 1 }
			}
			center_of_trade = $level$
		}
		else_if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 2 }
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = { which = var value = 2 }
					}
				}
				add_center_of_trade_level = 2
			}
			else = {
				add_center_of_trade_level = 1
			}
		}
		else_if = {
			limit = {
				NOT = { province_has_center_of_trade_of_level = 3 }
			}
			add_center_of_trade_level = 1
		}
		else = {
			add_base_production = 2
		}
	}
	else_if = {
		limit = {
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = var
					value = $level$
				}
				NOT = { check_variable = { which = var value = 0 } }
			}
		}
		if = {
			limit = {
				province_has_center_of_trade_of_level = 3
			}
			if = {
				limit = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = var
							value = $level$
						}
						check_variable = { which = var value = -1 }
					}
				}
				add_center_of_trade_level = -1
			}
			else = {
				add_center_of_trade_level = -2
			}
		}
		else_if = {
			limit = {
				province_has_center_of_trade_of_level = 2
			}
			add_center_of_trade_level = -1
		}
	}
}


# usage:
## has_better_tech_than = { who = PREV amount = 1 }
has_better_tech_than = {
	$who$ = {
		custom_trigger_tooltip = {
			tooltip = HAS_BETTER_TECH_THAN_TT
			OR = {
				num_of_cities = $amount$ # for the tooltip
				always = yes
			}
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = our_tech_amount
					value = trigger_value:adm_tech
					who = PREV
				}
				export_to_variable = {
					which = our_dip_tech_amount
					value = trigger_value:dip_tech
					who = PREV
				}
				export_to_variable = {
					which = our_mil_tech_amount
					value = trigger_value:mil_tech
					who = PREV
				}
				change_variable = { which = our_tech_amount which = our_dip_tech_amount }
				change_variable = { which = our_tech_amount which = our_mil_tech_amount }
				export_to_variable = {
					which = their_tech_amount
					value = trigger_value:adm_tech
				}
				export_to_variable = {
					which = their_dip_tech_amount
					value = trigger_value:dip_tech
				}
				export_to_variable = {
					which = their_mil_tech_amount
					value = trigger_value:mil_tech
				}
				change_variable = { which = their_tech_amount which = their_dip_tech_amount }
				change_variable = { which = their_tech_amount which = their_mil_tech_amount }
				change_variable = { which = their_tech_amount value = $amount$ }
				check_variable = { which = our_tech_amount which = their_tech_amount }
			}
		}
	}
}

#####
# FOR LOOP
# Executes the $effect$ $amount$ of times.
# for = {
#	amount = 5
#	effect = "
#	random_owned_province = {
#		add_base_tax = 1
#	}
#	"
# }
#####


for = {
	set_variable = {
		which = ForLoopCounter
		value = $amount$
	}

	while = {
		limit = {
			check_variable = {
				which = ForLoopCounter
				value = 1
			}
		}
		$effect$
		subtract_variable = {
			which = ForLoopCounter
			value = 1
		}
	}
}

## adds army tradition until 100 is reached and then adds the rest as mil power
### add_prestige_or_monarch_power = { amount = <number> }
add_army_tradition_or_mil_power = {
	tooltip = {
		add_army_tradition = $amount$
	}
	custom_tooltip = ME_ADD_ARMY_TRADITION_OR_MIL_POWER
	hidden_effect = {
		for = {
			amount = $amount$
			effect = "
				if = {
					limit = {
						NOT = { army_tradition = 99.9 }
					}
					add_army_tradition = 1
				}
				else = {
					add_mil_power = 3
				}
			"
		}
	}
}

## adds prestige until 100 is reached and then adds the rest as a random monarch power
### add_prestige_or_monarch_power = { amount = <number> }
add_prestige_or_monarch_power = {
	tooltip = {
		add_prestige = $amount$
	}
	custom_tooltip = ME_ADD_PRESTIGE_OR_MONARCHPOWER
	hidden_effect = {
		for = {
			amount = $amount$
			effect = "
				if = {
					limit = {
						NOT = { prestige = 100 }
					}
					add_prestige = 1
				}
				else = {
					add_adm_power = 1
					add_dip_power = 1
					add_mil_power = 1
				}
			"
		}
	}
}	

#####################
# 	USAGE
# 	pick_best_provinces = {
#		global_trigger = "your global triggers here" OPTIONAL
#		<example>
#		global_trigger = "
#		OR = {
#			continent = europe
#			allied_with = ROOT
#		}"
#		scale = your trigger type here REQUIRED
#		<example> scale = army_size
#		<number of provinces here> = yes (supported numbers: 1-3) REQUIRED
#		event_target_name = "your name for event target here> REQUIRED
#		scope = <Your scope here> (default: every_province)
#	}
#####################

pick_best_provinces = {
	[[scope]
		pick_best_provinces_2 = {
			scope = "$scope$"
			scale = "$scale$"
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
		set_global_flag = PICK_BEST_PROVINCES_FLAG
	] #curses for not having an [ELSE ] or something.
	if = {
		limit = {
			NOT = { has_global_flag = PICK_BEST_PROVINCES_FLAG } #This check is here to prevent the algorithm from being run again after the scoped version was executed
		}
		pick_best_provinces_2 = {
			scope = " every_province "
			scale = "$scale$"
			event_target_name = "$event_target_name$"
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
	}
	else = { clr_global_flag = PICK_BEST_PROVINCES_FLAG }
}

pick_best_provinces_2 = {
	hidden_effect = {
		[[1]
			if = {
				limit = { always = $1$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
			}
		]
		[[2]
			if = {
				limit = { always = $2$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
			}
		]
		[[3]
			if = {
				limit = { always = $3$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
			}
		]
		[[4]
			if = {
				limit = { always = $4$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
			}
		]
		[[5]
			if = {
				limit = { always = $5$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
			}
		]
		[[10]
			if = {
				limit = { always = $10$ }
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 7
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 8
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 9
				}
				pick_best_province = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 10
				}
			}
		]
		$scope$ = {
			limit = {
				has_province_flag = $event_target_name$_exclude
			}
			clr_province_flag = $event_target_name$_exclude
		}
	}
}

pick_best_province = {
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			NOT = { has_province_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			$scale$ = event_target:$event_target_name$_$number$
			NOT = { has_province_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	event_target:$event_target_name$_$number$ = {
		set_province_flag = $event_target_name$_exclude
	}
}

#add_mana_scaled_on_monthly_monarch_power = yes
add_mana_scaled_on_monthly_monarch_power = {
	custom_tooltip = ME_ADD_MANA_MONTHLY_TT
	if = {
		limit = { monthly_adm = 17 }
		add_adm_power = 120
	}
	else_if = {
		limit = { monthly_adm = 14 }
		add_adm_power = 100
	}
	else_if = {
		limit = { monthly_adm = 11 }
		add_adm_power = 80
	}
	else_if = {
		limit = { monthly_adm = 8 }
		add_adm_power = 60
	}
	else_if = {
		limit = { monthly_adm = 5 }
		add_adm_power = 40
	}
	else = {
		add_adm_power = 20
	}
	if = {
		limit = { monthly_dip = 17 }
		add_dip_power = 120
	}
	else_if = {
		limit = { monthly_dip = 14 }
		add_dip_power = 100
	}
	else_if = {
		limit = { monthly_dip = 11 }
		add_dip_power = 80
	}
	else_if = {
		limit = { monthly_dip = 8 }
		add_dip_power = 60
	}
	else_if = {
		limit = { monthly_dip = 5 }
		add_dip_power = 40
	}
	else = {
		add_dip_power = 20
	}
	if = {
		limit = { monthly_mil = 17 }
		add_mil_power = 120
	}
	else_if = {
		limit = { monthly_mil = 14 }
		add_mil_power = 100
	}
	else_if = {
		limit = { monthly_mil = 11 }
		add_mil_power = 80
	}
	else_if = {
		limit = { monthly_mil = 8 }
		add_mil_power = 60
	}
	else_if = {
		limit = { monthly_mil = 5 }
		add_mil_power = 40
	}
	else = {
		add_mil_power = 20
	}
}
#Add from 1 to 3 develop in province[s] based on the Monthly Monarch Power Gained
# add_development_half_monthly_monarch_power = yes
add_development_half_monthly_monarch_power = {
	custom_tooltip = ME_ADD_HALF_DEV_MONTHLY_TT
	if = {
		limit = {
			owner = { monthly_adm = 17 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 11 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 5 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { monthly_dip = 17 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 11 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 5 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { monthly_mil = 17 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 11 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 5 }
		}
		add_base_manpower = 1
	}
}
#########
# add_mana_scaled_on_monarch_skill = yes
add_mana_scaled_on_monarch_skill = {
	custom_tooltip = ME_ADD_MANA_TT
	if = {
		limit = { ADM = 6 }
		add_adm_power = 120
	}
	else_if = {
		limit = { ADM = 5 }
		add_adm_power = 100
	}
	else_if = {
		limit = { ADM = 4 }
		add_adm_power = 80
	}
	else_if = {
		limit = { ADM = 3 }
		add_adm_power = 60
	}
	else_if = {
		limit = { ADM = 2 }
		add_adm_power = 40
	}
	else = {
		add_adm_power = 20
	}
	if = {
		limit = { DIP = 6 }
		add_dip_power = 120
	}
	else_if = {
		limit = { DIP = 5 }
		add_dip_power = 100
	}
	else_if = {
		limit = { DIP = 4 }
		add_dip_power = 80
	}
	else_if = {
		limit = { DIP = 3 }
		add_dip_power = 60
	}
	else_if = {
		limit = { DIP = 2 }
		add_dip_power = 40
	}
	else = {
		add_dip_power = 20
	}
	if = {
		limit = { MIL = 6 }
		add_mil_power = 120
	}
	else_if = {
		limit = { MIL = 5 }
		add_mil_power = 100
	}
	else_if = {
		limit = { MIL = 4 }
		add_mil_power = 80
	}
	else_if = {
		limit = { MIL = 3 }
		add_mil_power = 60
	}
	else_if = {
		limit = { MIL = 2 }
		add_mil_power = 40
	}
	else = {
		add_mil_power = 20
	}
}

#Add from 1 to 6 develop in province[s] based on the Monthly Monarch Power Gained
# add_development_scaled_on_monthly_monarch_power = yes
add_development_scaled_on_monthly_monarch_power = {
	custom_tooltip = ME_ADD_DEV_MONTHLY_TT
	if = {
		limit = {
			owner = { monthly_adm = 17 }
		}
		add_base_tax = 6
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 14 }
		}
		add_base_tax = 5
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 11 }
		}
		add_base_tax = 4
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 8 }
		}
		add_base_tax = 3
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 5 }
		}
		add_base_tax = 2
	}
	else_if = {
		limit = {
			owner = { monthly_adm = 2 }
		}
		add_base_tax = 1
	}
	if = {
		limit = {
			owner = { monthly_dip = 17 }
		}
		add_base_production = 6
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 14 }
		}
		add_base_production = 5
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 11 }
		}
		add_base_production = 4
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 8 }
		}
		add_base_production = 3
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 5 }
		}
		add_base_production = 2
	}
	else_if = {
		limit = {
			owner = { monthly_dip = 2 }
		}
		add_base_production = 1
	}
	if = {
		limit = {
			owner = { monthly_mil = 17 }
		}
		add_base_manpower = 6
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 14 }
		}
		add_base_manpower = 5
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 11 }
		}
		add_base_manpower = 4
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 8 }
		}
		add_base_manpower = 3
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 5 }
		}
		add_base_manpower = 2
	}
	else_if = {
		limit = {
			owner = { monthly_mil = 2 }
		}
		add_base_manpower = 1
	}
}

## add/remove <value> papal influence, church power, etc.
### change_religious_influence_equivalent = { add = <number> }
### change_religious_influence_equivalent = { remove = <number> }
### value MUST be positive
change_religious_influence_equivalent = {
	[[add]
		add_papal_influence = $add$
		add_church_power = $add$
		add_fervor = $add$
		add_patriarch_authority = 0.$add$
		add_doom = $add$
		add_karma = $add$
		add_authority = $add$
		add_piety = 0.$add$
		if = {
			limit = {
				religion = confucianism
			}
			add_harmony = $add$
		}
		else = {
			hidden_effect = {
				add_harmony = $add$	# just in case any other religion might use harmony, it's added without a tooltip
			}
		}
	]
	[[remove]
		add_papal_influence = -$remove$
		add_church_power = -$remove$
		add_fervor = -$remove$
		add_patriarch_authority = -0.$remove$
		add_doom = -$remove$
		add_karma = -$remove$
		add_authority = -$remove$
		add_piety = -0.$remove$
		if = {
			limit = {
				religion = confucianism
			}
			add_harmony = -$remove$
		}
		else = {
			hidden_effect = {
				add_harmony = -$remove$	# just in case any other religion might use harmony, it's removed without a tooltip
			}
		}
	]
}

add_or_upgrade_trade_building = {
	custom_tooltip = add_or_upgrade_trade_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = marketplace
			}
			add_building = trade_depot
		}
		else_if = {
			limit = {
				has_building = trade_depot
			}
			add_building = stock_exchange
		}
		else_if = {
			limit = {
				has_building = stock_exchange
			}
			add_base_tax = 1
			add_base_production = 1
		}
		else = {
			add_building = marketplace
		}
	}
}

add_or_upgrade_tax_building = {
	custom_tooltip = add_or_upgrade_tax_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = temple
			}
			add_building = cathedral
		}
		else_if = {
			limit = {
				has_building = cathedral
			}
			add_base_tax = 2
		}
		else = {
			add_building = temple
		}
	}
}

add_or_upgrade_production_building = {
	custom_tooltip = add_or_upgrade_production_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = workshop
			}
			add_building = counting_house
		}
		else_if = {
			limit = {
				has_building = counting_house
			}
			add_base_production = 2
		}
		else = {
			add_building = workshop
		}
	}
}

add_or_upgrade_dock_building = {
	custom_tooltip = add_or_upgrade_dock_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = dock
			}
			add_building = drydock
		}
		else_if = {
			limit = {
				has_building = drydock
			}
			ROOT = { add_sailors = 0.5 }
		}
		else = {
			add_building = dock
		}
	}
}

add_or_upgrade_shipyard_building = {
	custom_tooltip = add_or_upgrade_shipyard_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = shipyard
			}
			add_building = grand_shipyard 
		}
		else_if = {
			limit = {
				has_building = grand_shipyard 
			}
			ROOT = { add_sailors = 0.5 }
		}
		else = {
			add_building = shipyard
		}
	}
}

add_or_upgrade_manpower_building = {
	custom_tooltip = add_or_upgrade_manpower_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = barracks
			}
			add_building = training_fields  
		}
		else_if = {
			limit = {
				has_building = training_fields  
			}
			add_base_tax = 1
			add_base_manpower = 1
		}
		else = {
			add_building = barracks
		}
	}
}

add_or_upgrade_forcelimit_building = {
	custom_tooltip = add_or_upgrade_forcelimit_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = regimental_camp
			}
			add_building = conscription_center   
		}
		else_if = {
			limit = {
				has_building = conscription_center   
			}
			add_base_manpower = 2
		}
		else = {
			add_building = regimental_camp
		}
	}
}

add_or_upgrade_university_building = {
	custom_tooltip = add_or_upgrade_university_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = university
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
		else = {
			add_building = university
		}
	}
}

add_or_upgrade_courthouse_building = {
	custom_tooltip = add_or_upgrade_courthouse_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = courthouse
			}
			add_building = town_hall   
		}
		else_if = {
			limit = {
				has_building = town_hall   
			}
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
		else = {
			add_building = courthouse
		}
	}
}

add_or_upgrade_fort_building = {
	custom_tooltip = add_or_upgrade_fort_building_tt
	hidden_effect = {
		if = {
			limit = {
				has_building = fort_15th
			}
			add_building = fort_16th
		}
		else_if = {
			limit = {
				has_building = fort_16th
			}
			add_building = fort_17th
		}
		else_if = {
			limit = {
				has_building = fort_17th
			}
			add_building = fort_18th
		}
		else_if = {
			limit = {
				has_building = fort_18th
			}
			add_base_manpower = 3
		}
		else = {
			add_building = fort_15th
		}
	}
}

## adds the culture as an accepted culture or 100 dip power
### add_accepted_culture_or_dip_power = { culture = <culture> }
### the custom effect is only able to check for up to 10 culture slots
add_accepted_culture_or_dip_power = {
	tooltip = {
		add_accepted_culture = $culture$
	}
	custom_tooltip = ADD_ACCEPTED_CULTURE_TT
	hidden_effect = {
		if = {
			limit = {
				accepted_culture = $culture$
			}
			add_dip_power = 100
		}
		else_if = {
			limit = {
				primary_culture = $culture$
			}
			add_dip_power = 100
		}
		else_if = {
			limit = {
				num_accepted_cultures = 10
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 11
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 9
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 10
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 8
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 9
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 7
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 8
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 6
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 7
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 5
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 6
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 4
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 5
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 3
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 4
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 2
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 3
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				num_accepted_cultures = 1
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 2
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else_if = {
			limit = {
				NOT = { num_accepted_cultures = 1 }
			}
			if = {
				limit = {
					has_global_modifier_value = {
						which = num_accepted_cultures
						value = 1
					}
				}
				add_accepted_culture = $culture$
			}
			else = {
				add_dip_power = 100
			}
		}
		else = {
			add_dip_power = 100
		}
	}
}

change_national_focus_effect = {
	if = {
		limit = {
			OR = {
				has_dlc = "Res Publica"
				has_dlc = "Common Sense"
			}
		}
		custom_tooltip = ME_CHANGE_NATIONAL_FOCUS_TT
		hidden_effect = {
			country_event = { id = missions_expanded_events.2 }
		}
	}
}
## breaks the alliance between current scope and who
### break_alliance_with = { who = <scope> }
break_alliance_with = {
	if = {
		limit = {
			alliance_with = $who$
		}
		$who$ = {
			custom_tooltip = BREAK_ALLIANCE_WITH_TT
		}
		hidden_effect = {
			add_rival = $who$
			remove_rival = $who$
		}
	}
}
#####################
# 	USAGE
# 	pick_best_tags = {
#		global_trigger = "your global triggers here" OPTIONAL
#		<example>
#		global_trigger = "
#		OR = {
#			continent = europe
#			allied_with = ROOT
#		}"
#		scale = your trigger type here REQUIRED
#		<example>
#		scale = army_size
#		<number of tags here> = yes (supported numbers: 1-3) REQUIRED
#		event_target_name = "your name for event target here> REQUIRED
#		scope = "your scope here> OPTIONAL
#		<example>
#		scope = "every_neighbor_country"
#		default is every_country
#	}
#####################

pick_best_tags = {
	[[scope]
		pick_best_tags_2 = {
			scope = $scope$
			scale = $scale$
			event_target_name = $event_target_name$
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
		set_global_flag = PICK_BEST_TAG_FLAG
	] #curses for not having an [ELSE ] or something.
	if = {
		limit = {
			NOT = { has_global_flag = PICK_BEST_TAG_FLAG } #This check is here to prevent the algorithm from being run again after the scoped version was executed
		}
		pick_best_tags_2 = {
			scope = every_country
			scale = $scale$
			event_target_name = $event_target_name$
			global_trigger = "$global_trigger$"
			1 = "$1$"
			2 = "$2$"
			3 = "$3$"
			4 = "$4$"
			5 = "$5$"
			10 = "$10$"
		}
	}
	else = { clr_global_flag = PICK_BEST_TAG_FLAG }
}

pick_best_tags_2 = {
	hidden_effect = {
		[[1]
			if = {
				limit = { always = $1$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
			}
		]
		[[2]
			if = {
				limit = { always = $2$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
			}
		]
		[[3]
			if = {
				limit = { always = $3$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
			}
		]
		[[4]
			if = {
				limit = { always = $4$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
			}
		]
		[[5]
			if = {
				limit = { always = $5$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
			}
		]
		[[10]
			if = {
				limit = { always = $10$ }
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 1
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 2
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 3
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 4
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 5
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 6
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 7
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 8
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 9
				}
				pick_best_tag = {
					scale = "$scale$"
					scope = $scope$
					global_trigger = "$global_trigger$"
					event_target_name = "$event_target_name$"
					number = 10
				}
			}
		]
		$scope$ = {
			limit = {
				has_country_flag = $event_target_name$_exclude
			}
			clr_country_flag = $event_target_name$_exclude
		}
	}
}

pick_best_tag = {
	1 = { save_event_target_as = $event_target_name$_$number$ }
	$scope$ = {
		limit = {
			[[global_trigger] $global_trigger$ ]
			$scale$ = event_target:$event_target_name$_$number$
			NOT = { has_country_flag = $event_target_name$_exclude }
		}
		save_event_target_as = $event_target_name$_$number$
	}
	event_target:$event_target_name$_$number$ = {
		set_country_flag = $event_target_name$_exclude
	}
}

#####################
# 	USAGE
# 	pick_best_provinces = {
#		global_trigger = "your global triggers here" OPTIONAL
#		<example>
#		global_trigger = "
#		OR = {
#			continent = europe
#			allied_with = ROOT
#		}"
#		scale = your trigger type here REQUIRED
#		<example> scale = army_size
#		<number of provinces here> = yes (supported numbers: 1-3) REQUIRED
#		event_target_name = "your name for event target here> REQUIRED
#		scope = <Your scope here> (default: every_province)
#	}
#####################

# province scope
## add manufactory in scope
### build_possible_manufactory_in_province = yes
build_possible_manufactory_in_province = {
	custom_tooltip = BUILD_MATCHING_MANUFACTORY_IN_THIS_PROVINCE
	hidden_effect = {
		if = {
			limit = {
				has_no_manufactory_trigger = yes
			}
			if = {
				limit = {
					OR = {
						trade_goods = naval_supplies
						trade_goods = fish
						trade_goods = salt
					}
				}
				if = {
					limit = {
						ROOT = { dip_tech = 11 }
					}
					add_building = wharf
				}
				else = {
					ROOT = { add_dip_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = copper
						trade_goods = iron
					}
				}
				if = {
					limit = {
						ROOT = { mil_tech = 11 }
					}
					add_building = weapons
				}
				else = {
					ROOT = { add_mil_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = wool
						trade_goods = cloth
						trade_goods = silk
						trade_goods = dyes
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 11 }
					}
					add_building = textile
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = coffee
						trade_goods = cotton
						trade_goods = sugar
						trade_goods = tobacco
						trade_goods = tea
						trade_goods = cocoa
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 14 }
					}
					add_building = plantations
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = ivory
						trade_goods = slaves
						trade_goods = spices
						trade_goods = fur
						trade_goods = incense
					}
				}
				if = {
					limit = {
						ROOT = { dip_tech = 14 }
					}
					add_building = tradecompany
				}
				else = {
					ROOT = { add_dip_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = livestock
						trade_goods = wine
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 6 }
					}
					add_building = farm_estate
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					OR = {
						trade_goods = paper
						trade_goods = gems
						trade_goods = tropical_wood
						trade_goods = glass
						trade_goods = chinaware
					}
				}
				if = {
					limit = {
						ROOT = { adm_tech = 16 }
					}
					add_building = mills
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else_if = {
				limit = {
					has_dlc = "Rule Britannia"
					trade_goods = coal
				}
				if = {
					limit = {
						ROOT = { adm_tech = 21 }
					}
					add_building = furnace
				}
				else = {
					ROOT = { add_adm_power = 20 }
				}
			}
			else = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
		}
		else = {
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
	}
}